<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录 - 留学服务平台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <div class="row justify-content-center mt-10">
            <div class="col-md-6 auth-container">
                <h2 class="text-center mb-4">用户登录</h2>
                
                <form id="login-form">
                    <div class="form-group">
                        <label for="username">用户名</label>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">密码</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="role">用户角色</label>
                        <select class="form-control" id="role" required>
                            <option value="student">留学生</option>
                            <option value="teacher">教师</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block w-100 mt-4">登录</button>
                </form>
                
                <div class="text-center mt-4">
                    <p>还没有账号？<a href="register.html">立即注册</a></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../js/common.js"></script>
    <script>
        // 测试资源加载和axios初始化
        console.log('页面资源加载测试');
        console.log('axios是否可用:', typeof axios !== 'undefined');
        if (typeof axios !== 'undefined') {
            console.log('axios初始化成功!');
        } else {
            console.error('axios未加载成功!');
        }
    </script>
    <script>
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            try {
                // 使用URLSearchParams格式提交登录信息（OAuth2PasswordRequestForm需要）
                const formData = new URLSearchParams();
                formData.append('username', username);
                formData.append('password', password);
                formData.append('scope', role); // 将角色信息放在scope中
                
                const response = await axios.post(
                    API_BASE_URL + '/auth/login',
                    formData,
                    {
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        }
                    }
                );
                
                // 保存登录信息
                saveLoginInfo(response.data.access_token, role);
                
                // 根据角色跳转到相应的仪表盘
                if (role === 'student') {
                    window.location.href = 'student/dashboard.html';
                } else {
                    window.location.href = 'teacher/dashboard.html';
                }
            } catch (error) {
                console.error('登录失败:', error);
            }
        });
    </script>
</body>
</html>